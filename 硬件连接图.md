# STM32温湿度采集与OLED显示系统 - 硬件连接图

## 项目概述
基于STM32F103C8T6的温湿度监测系统，具备OLED显示、WiFi通信、自动控制等功能。

## 元器件清单
- STM32F103C8T6 微控制器
- OLED显示屏 (0.96寸 I2C接口)
- DHT11 温湿度传感器
- ESP8266 WiFi模块
- 蜂鸣器
- 继电器模块 (控制风扇)
- 按键 x4
- 风扇 (220V交流或12V直流)

## STM32F103C8T6 引脚分配表

| 器件 | 引脚 | STM32引脚 | 功能说明 |
|------|------|-----------|----------|
| **OLED显示屏** | SCL | PB6 | I2C时钟线 |
| | SDA | PB7 | I2C数据线 |
| **DHT11温湿度传感器** | DATA | PB1 | 数据线 |
| **LED指示灯** | - | PC13 | 板载LED状态指示 |
| **按键1** | - | PA15 | 模式切换 |
| **按键2** | - | PB3 | 设置温度阈值 |
| **按键3** | - | PB4 | 设置湿度阈值 |
| **按键4** | - | PB5 | 确认/取消 |
| **蜂鸣器** | + | PA0 | 报警提示 |
| **继电器** | IN | PA1 | 控制风扇 |
| **ESP8266** | TX | PA3 (USART2_RX) | WiFi通信接收 |
| | RX | PA2 (USART2_TX) | WiFi通信发送 |

## 详细硬件连接图

```
STM32F103C8T6 (蓝丸板)
├── 电源部分
│   ├── 3.3V → DHT11, OLED, ESP8266, 蜂鸣器
│   ├── 5V → 继电器模块VCC (SRD-05VDC-SL-C)
│   └── GND → 公共地线
│
├── 显示模块
│   └── OLED显示屏 (0.96寸 I2C)
│       ├── VCC → 3.3V
│       ├── GND → GND
│       ├── SCL → PB6 (I2C1_SCL)
│       └── SDA → PB7 (I2C1_SDA)
│
├── 传感器模块
│   └── DHT11温湿度传感器
│       ├── VCC → 3.3V
│       ├── GND → GND
│       ├── DATA → PB1
│       └── NC → 悬空
│
├── 输入模块 (按键)
│   ├── 按键1 → PA15 + GND (模式切换：手动/自动)
│   ├── 按键2 → PB3 + GND (温度阈值设置)
│   ├── 按键3 → PB4 + GND (湿度阈值设置)
│   └── 按键4 → PB5 + GND (确认/取消)
│
├── 输出模块
│   ├── 板载LED → PC13 (状态指示，低电平点亮)
│   ├── 蜂鸣器 → PA0 + GND (报警提示)
│   └── 继电器模块 → PA1 (控制风扇)
│       ├── VCC → 5V
│       ├── GND → GND
│       ├── IN → PA1
│       ├── COM → 风扇电源正极
│       ├── NO → 风扇负极
│       └── NC → 悬空
│
└── 通信模块
    └── ESP8266 WiFi模块
        ├── VCC → 3.3V
        ├── GND → GND
        ├── TX → PA10 (连接STM32的RX)
        ├── RX → PA9 (连接STM32的TX)
        ├── EN → 3.3V (使能)
        ├── RST → 3.3V (复位)
        ├── GPIO0 → 悬空 (正常模式)
        └── GPIO2 → 悬空
```

## 外围设备连接详情

### 1. 风扇控制电路
**220V交流风扇：**
```
电源火线 → 继电器COM
继电器NO → 风扇火线
风扇零线 → 电源零线
```

**12V直流风扇：**
```
12V正极 → 继电器COM  
继电器NO → 风扇正极
风扇负极 → 12V负极
```

### 2. 电源分配方案
- STM32主控：3.3V (USB供电或外部5V转3.3V)
- DHT11传感器：3.3V
- OLED显示屏：3.3V  
- ESP8266：3.3V
- 继电器模块：5V (SRD-05VDC-SL-C，从STM32的5V引脚供电)
- 蜂鸣器：3.3V
- 板载LED：内置，无需外接

**电流消耗分析：**
- 系统总电流：约200-330mA
- USB 2.0供电能力：500mA
- USB 3.0供电能力：900mA
- **结论：USB供电完全够用**

### 3. 按键电路
```
每个按键连接方式：
按键一端 → STM32对应引脚
按键另一端 → GND
STM32引脚内部上拉电阻使能
```

## 功能实现说明

### 1. 显示功能
- OLED显示当前温湿度
- 显示设定阈值
- 显示工作模式
- 显示温度数据曲线

### 2. 控制功能
- 按键1：切换手动/自动模式
- 按键2：调节温度阈值
- 按键3：调节湿度阈值  
- 按键4：确认设置

### 3. 报警功能
- 温湿度超阈值时：蜂鸣器响 + LED闪烁
- ESP8266发送报警信息到APP

### 4. 风扇控制
- 手动模式：按键控制风扇开关
- 自动模式：温度超阈值自动启动风扇

## 引脚使用状态
✅ **无冲突** - 所有引脚都已合理分配，没有重复使用

## 注意事项
1. **继电器模块供电**：SRD-05VDC-SL-C可直接使用STM32的5V引脚供电
2. **电流充足性**：系统总电流约200-330mA，USB供电(500mA)完全够用
3. **控制信号兼容**：继电器控制信号为3.3V兼容，可直接连接STM32 GPIO
4. DHT11数据线建议加4.7kΩ上拉电阻
5. ESP8266的EN和RST引脚需要上拉到3.3V
6. 板载LED为低电平点亮（PC13输出低电平时LED亮）
7. 所有按键使用内部上拉电阻，按下时为低电平
8. **供电建议**：如果系统不稳定，可考虑使用外部5V电源适配器

## 版本信息
- 创建日期：2025-01-18
- 版本：v1.0
- 状态：当前使用版本